# Airflow Setup –¥–ª—è Wildfire Prediction System

## üìã **–û–±–∑–æ—Ä DAG'–æ–≤**

### **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ (–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞):**

1. **`wildfire_historical_fire_data`** - –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∂–∞—Ä–∞—Ö –∏–∑ CSV
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç `russia_fires_hist.csv` –∏–∑ MinIO
   - –°–æ–∑–¥–∞–µ—Ç –±–∞–∑–æ–≤—ã–µ ML –ø—Ä–∏–∑–Ω–∞–∫–∏
   - –°–æ–∑–¥–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø–æ–∂–∞—Ä–∞–º
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ~5-10 –º–∏–Ω—É—Ç

2. **`wildfire_historical_weather_data`** - –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–µ–æ–¥–∞–Ω–Ω—ã—Ö –∏–∑ ERA5
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `era5_instant_3years.nc` –∏ `era5_accum_3years.nc`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `xarray` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ .nc —Ñ–∞–π–ª–æ–≤
   - –û–±–Ω–æ–≤–ª—è–µ—Ç ML –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å –ø–æ–≥–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ~30-60 –º–∏–Ω—É—Ç (—Ç—è–∂–µ–ª—ã–µ —Ñ–∞–π–ª—ã)

### **–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ DAG'–∏:**

3. **`wildfire_data_pipeline`** - –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **`wildfire_ml_pipeline`** - –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ ML –º–æ–¥–µ–ª–µ–π
5. **`wildfire_monitoring`** - –ü–æ—á–∞—Å–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã

## üîß **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Connections**

### **1. PostgreSQL Connection (`wildfire_db`)**
```
Connection Id: wildfire_db
Connection Type: Postgres
Host: localhost (–∏–ª–∏ –≤–∞—à PostgreSQL —Å–µ—Ä–≤–µ—Ä)
Schema: wildfire (–∏–ª–∏ –≤–∞—à–∞ —Å—Ö–µ–º–∞)
Login: –≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
Password: –≤–∞—à_–ø–∞—Ä–æ–ª—å
Port: 5432
```

### **2. MinIO Connection (`minio_default`)**
```
Connection Id: minio_default
Connection Type: Amazon Web Services
Login: minioadmin (–∏–ª–∏ –≤–∞—à access key)
Password: minioadmin (–∏–ª–∏ –≤–∞—à secret key)
Host: localhost:9000 (–∏–ª–∏ –≤–∞—à MinIO endpoint)
```

### **3. HTTP API Connection (`wildfire_api`)**
```
Connection Id: wildfire_api
Connection Type: HTTP
Host: http://localhost:8000 (–∏–ª–∏ –≤–∞—à FastAPI —Å–µ—Ä–≤–µ—Ä)
```

## üìä **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü**

### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `fireforceai.historical_fires` - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–∂–∞—Ä–∞—Ö
- `fireforceai.raw_weather_data` - –°—ã—Ä—ã–µ –º–µ—Ç–µ–æ—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
- `fireforceai.training_features` - –ü—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è ML –æ–±—É—á–µ–Ω–∏—è
- `fireforceai.fire_statistics` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∂–∞—Ä–æ–≤

## üöÄ **–ü–æ—Ä—è–¥–æ–∫ –∑–∞–ø—É—Å–∫–∞**

### **–®–∞–≥ 1: –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∂–∞—Ä–∞—Ö**
```bash
# –í Airflow UI –∑–∞–ø—É—Å—Ç–∏—Ç–µ DAG –≤—Ä—É—á–Ω—É—é:
wildfire_historical_fire_data
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ~50,000-100,000 –∑–∞–ø–∏—Å–µ–π –æ –ø–æ–∂–∞—Ä–∞—Ö
- –ë–∞–∑–æ–≤—ã–µ ML –ø—Ä–∏–∑–Ω–∞–∫–∏ —Å–æ–∑–¥–∞–Ω—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≥–æ–¥–∞–º/–º–µ—Å—è—Ü–∞–º

### **–®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –º–µ—Ç–µ–æ–¥–∞–Ω–Ω—ã—Ö**
```bash
# –í Airflow UI –∑–∞–ø—É—Å—Ç–∏—Ç–µ DAG –≤—Ä—É—á–Ω—É—é:
wildfire_historical_weather_data
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ~100,000-200,000 –∑–∞–ø–∏—Å–µ–π –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ML –ø—Ä–∏–∑–Ω–∞–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã —Å –ø–æ–≥–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ 3 –ª–µ—Ç (2021-2024)

### **–®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
SELECT COUNT(*) FROM fireforceai.historical_fires;
SELECT COUNT(*) FROM fireforceai.raw_weather_data;
SELECT COUNT(*) FROM fireforceai.training_features;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è –ø–æ–≥–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
SELECT 
    COUNT(*) as total_samples,
    COUNT(*) FILTER (WHERE avg_temperature IS NOT NULL) as with_weather
FROM fireforceai.training_features;
```

## üìÅ **MinIO Bucket Structure**

```
fire-datasets/
‚îú‚îÄ‚îÄ russia_fires_hist.csv          # –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–∂–∞—Ä–∞—Ö (37.7 MiB)
‚îú‚îÄ‚îÄ era5_instant_3years.nc         # –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –º–µ—Ç–µ–æ–¥–∞–Ω–Ω—ã–µ (293.8 MiB)
‚îî‚îÄ‚îÄ era5_accum_3years.nc           # –ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–µ–æ–¥–∞–Ω–Ω—ã–µ (39.9 MiB)
```

## üîç **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
```bash
# –í Airflow UI -> DAGs -> Task Instance -> Log
# –ò–ª–∏ —á–µ—Ä–µ–∑ CLI:
airflow tasks logs wildfire_historical_fire_data load_historical_fire_data_from_minio latest
```

### **XCom –¥–∞–Ω–Ω—ã–µ:**
- `fire_data_stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–∂–∞—Ä–∞—Ö
- `weather_data_stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–µ—Ç–µ–æ–¥–∞–Ω–Ω—ã—Ö
- `feature_stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö ML –ø—Ä–∏–∑–Ω–∞–∫–æ–≤

## ‚ö†Ô∏è **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º**

### **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤:**
```bash
pip install xarray netCDF4 minio pandas numpy
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:**
```python
import xarray as xr
import pandas as pd
import numpy as np
from minio import Minio
print("‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã")
```

## üõ†Ô∏è **Troubleshooting**

### **–ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ xarray**
```bash
# –†–µ—à–µ–Ω–∏–µ: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install xarray netCDF4
```

### **–ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MinIO**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ connection –≤ Airflow UI
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MinIO –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
```

### **–ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ ERA5**
```python
# –í DAG –¥–æ–±–∞–≤—å—Ç–µ chunking –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤:
ds = xr.open_dataset(nc_file_path, chunks={"valid_time": 1})
```

### **–ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ PostgreSQL**
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:
SELECT 1;
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ö–µ–º—É:
SELECT * FROM information_schema.schemata WHERE schema_name = 'fireforceai';
```

## üìà **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**

### **–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ DAG
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
- –ü–æ–∫—Ä—ã—Ç–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏
- –ö–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö (–≤–∞–ª–∏–¥–∞—Ü–∏—è)

### **–ê–ª–µ—Ä—Ç—ã:**
- –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –º–µ—Ç–µ–æ–¥–∞–Ω–Ω—ã–º–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–∞—á–µ—Å—Ç–≤–æ–º –¥–∞–Ω–Ω—ã—Ö

## üîÑ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö:

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ DAG'–∏** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ ML pipeline** –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö
4. **–°–æ–∑–¥–∞–π—Ç–µ –¥–∞—à–±–æ—Ä–¥—ã** –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üìû **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Airflow UI
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ connections
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å MinIO –∏ PostgreSQL
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π 